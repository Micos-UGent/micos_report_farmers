---
title: "Data for `r params$Farmer`"
output: pdf_document
params:
   Farmer: MC24_008
---

```{r}
library(dplyr)
```

# INTRODUCTION

Within the micos project, 240 fields were sampled and different data (nutrients, soil texture, ...) were sampled. The goal is to create a report for each of these fields and thus for the farmer containg all this unique data. 

It is suggested that **parametrized reports** are the way to go. Therefore, this template is a first attempt in creating such reports. 

The idea is that within the yaml (first part of this document between the three dots) you specify a parameter (params: Farmer) whereby the data will be filtered on this parameter setting. In another script, the report will be rendered multiple times. 


# EXAMPLE

## Loading data

```{r, include = FALSE}
# Locate data
path <- ("./raw_data")

# Create full pathways to necessary data files
path_nutrients <- file.path(path, "Nutrient_data.csv")


## Check if paths exists
file.exists(path_nutrients)
```

```{r, include = FALSE}
# Load data
df_nutrients <- read.csv(path_nutrients, header = TRUE, sep = ";")
```

## NUTRIÃŠNTEN
```{r}
# Maak een test tabel met de gemiddelde waardes van het veld voor koolstof
df_nutrients %>%
  filter(Farmer == params$Farmer) %>%
  summarize(OC = mean(OC),
            TC = mean(TC),
            pH = mean(pH_KCl),
            Ntotaal = mean(Ntotaal),
            K = mean(K_AmLact),
            Mg = mean(Mg_AmLact),
            P = mean(P_AmLact),
            Ca = mean(Ca_AmLact)) %>%
  # maak "lange" tabel met variabele, stat en waarde
  pivot_longer(
    cols = everything(),
    names_to = c("Meting"),
    values_to = "Concentratie")


```
```{r}

library(dplyr)
library(tidyr)

# Vervang 'df' door de naam van jouw dataframe
vars <- c("pH_KCl", "OC", "TC", "IC", "IC.uitgevoerd",
          "Ntotaal", "K_AmLact", "Mg_AmLact", "Ca_AmLact", "P_AmLact")

summary_df <- df_nutrients %>%
  # selecteer alleen de bestaande kolommen (handig als er variabelen ontbreken)
  select(any_of(vars)) %>%
  # zorg dat niet-numerieke kolommen niet crashen bij mean/sd
  mutate(across(everything(), ~ suppressWarnings(as.numeric(.)))) %>%
  summarise(
    across(everything(),
           list(
             mean = ~ mean(.x, na.rm = TRUE),
             sd   = ~ sd(.x,   na.rm = TRUE)
           ),
           .names = "{.col}_{.fn}")
  ) %>%
  # maak "lange" tabel met variabele, stat en waarde
  pivot_longer(
    cols = everything(),
    names_to = c("Variabele", "Statistiek"),
    names_sep = "_",
    values_to = "Waarde"
  ) %>%
  # zet mean/sd onder elkaar per variabele
  arrange(Variabele, Statistiek) %>%
  # optioneel: afronden
  mutate(Waarde = round(Waarde, 3))

```
https://www.r-bloggers.com/2019/02/making-thematic-maps-for-belgium/


# Create beautiful table

skimr package from epirhandbook.com

# Parametrized reports

https://bookdown.org/yihui/rmarkdown/parameterized-reports.html 

- Useful if you want to create a report template that can be reused across multiple similar scenarios. 
Tutorial:

https://bookdown.org/yihui/rmarkdown/parameterized-reports.html
https://stackoverflow.com/questions/38572219/how-to-create-a-different-report-for-each-subset-of-a-data-frame-with-r-markdown


# STYLING DATA
Where to found great options for reports:

+ https://www.epirhandbook.com/en/new_pages/rmarkdown.html
